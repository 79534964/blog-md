---

title: 模板编译
date: 2018-12-11
categories: vue
tags: 模板编译

---

## compile
** 特点 **

** 1.通过createDocumentFragment创建一个虚拟dom将dom节点放到内存中 **

```javascript
function compile(el, vm) {
	// el表示替换的dom范围
	// vm表示vue实例
	vm.$el = document.querySelector(el);
	let fragment = document.createDocumentFragment();
	// 将dom放入内存中
	while(child = vm.$el.firstChild) {
		fragment.append(child);
	}
	replace(fragment);
	function replace(fragment) {
		Array.from(fragment.childNodes).forEach((node) => {
			let text = node.textContext;
			let reg = /\{\{(.*)\}\}/;
			// 判断是否是文本节点
			if(node.nodeType === 3 && reg.test(text)) {
				// RegExp.$1 a.a
				let arr = RegExp.$1.split('.'); // [a, a]
				let val = vm;
				arr.forEach((k)=> {
					val = val[k];
				});
				node.textContent = text.replace(reg, val);
			}
			if(node.childNodes) {
				replace(node);
			}
		});
	}
}
```
